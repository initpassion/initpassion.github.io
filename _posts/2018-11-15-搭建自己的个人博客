# tomcat开发笔记
## tomcat常见问题
### tomcat中文乱码处理
- 修改server.xml
```
 <Connector port="6036" protocol="HTTP/1.1"
        connectionTimeout="20000"
        redirectPort="6039" URIEncoding="UTF-8" 
 />
```
### tomcat使用指定路径的JDK
- vim bin/setclasspath.sh
- 修改方式一：
```
export JAVA_HOME=/usr/local/env/jdk1.8/
export JRE_HOME=/usr/local/env/jdk1.8/jre

```
- 修改方式二
```
经过测试，如下配置更加合理：
export JAVA_HOME=/home/jdk
export PATH=$JAVA_HOME/bin:$PATH
export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar

```
- 注:有的情况如下配置:

```
export JAVA_HOME=/usr/java/jdk1.7.0_80
export JRE_HOME=/usr/java/jdk1.7.0_80

```

### TOMCAT安全部署
一、如果不需要通过web gui形式部署webapp，请移除manger webapp

1、移除CATALINA_HOME/webapps下所有tomcat自带的内容（自己的应用除外）

2、移除CATALINA_HOME/conf/Catalina/localhost/host-manager.xml 和 CATALINA_HOME/conf/Catalina/localhost/manager.xml

二、如果需要通过web gui形式部署webapp，请保留manager webapp
3、在CATALINA_HOME/conf/tomcat-users.xml中增加manager角色的用户名和密码，密码请使用强密码

4、增加访问权限，仅某些ip或者某域的机器才能访问，修改CATALINA_HOME/conf/Catalina/localhost/manager.xml，增加如下内容：

<Valve className="org.apache.catalina.valves.RemoteAddrValve" allow="192.168.1.*" />

或者

<Valve className="org.apache.catalina.valves.RemoteHostValve" allow="*.localdomain.com" />

5、可以重命名manager webapp，让攻击者误以为没有安装manager webapp

a、修改CATALINA_HOME/conf/Catalina/localhost/manager.xml为CATALINA_HOME/conf/Catalina/localhost/foobar.xml

b、修改CATALINA_HOME/conf/Catalina/localhost/foobar.xml中的docBase属性为CATALINA_HOME/webapps/foobar

c、将CATALINA_HOME/webapps/manager更名为CATALINA_HOME/webapps/foobar

三、禁止目录遍历和调试功能
6、确保CATALINA_HOME/conf/web.xml中DefaultServlet的listings为false，debug为0

```
<servlet>
   <servlet-name>default</servlet-name>
   <servlet-class>org.apache.catalina.servlets.DefaultServlet</servlet-class>
   <init-param>
     <param-name>debug</param-name>
     <param-value>0</param-value>
   </init-param>
   <init-param>
     <param-name>listings</param-name>
     <param-value>false</param-value>  <!- make sure this is false ->
   </init-param>
   <load-on-startup>1</load-on-startup>
</servlet>
```

-- tomcat远程调试
- 修改tomcat/bin/catalina.sh

```
CATALINA_OPTS="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=28911"
```
